---
title: '&#32;'
output:
  html_document:
    df_print: paged
editor_options: 
  chunk_output_type: console
---

```{r, include=F, dependson="setup.R"}

library(tidyverse)
library(nycflights13)

set.seed(42)

flights <- flights %>% 
  slice_sample(prop=.35)

```

```{r, echo=F}
flights <- flights %>%
  mutate(time_of_day = case_when(
    sched_dep_time >= 001  & sched_dep_time <= 600  ~ "12:01am-6am",
    sched_dep_time >= 601  & sched_dep_time <= 1200 ~ "6:01am-12pm",
    sched_dep_time >= 1201 & sched_dep_time <= 1800 ~ "12:01pm-6pm",
    sched_dep_time >= 1801                          ~ "6:01pm-12am"
  ))
```

> Based on the last question, we created a new variable that divides the day into four time intervals and we called it `time_of_day`. 

> Now, lets do something with it. 

> One interesting thing is to calculate the proportion of flights that are delayed at departure for each of the four time intervals. In other words, we want to create the following table:

```{r, eval=T, echo=F}
# Find proportion of delayed flights for each time of day
flights %>%
  mutate(dep_delayed = ifelse(dep_delay > 0, "delayed", "ontime")) %>%
  count(time_of_day, dep_delayed) %>%
  group_by(time_of_day) %>%
  mutate(prop_delayed = n / sum(n)) %>%
  filter(dep_delayed == "delayed") %>%
  arrange(prop_delayed)
```

> Interesting, flights later in the day are delayed way more often. 

> Now, how do we generate this table? You only need the following two variable to do so:

| Variable Name | Description            |
|---------------|--------------------|
|   `time_of_day`| Day divided into four blocks of time |
|   `dep_delay`| Departure delays, in minutes. Negative times represent early departures |

```{r, echo=F}
flights %>% select(time_of_day, dep_delay) %>% head(n=8)
```

> Given these two variables, which of the following code chunks helps us meet our data analysis goal of generating the above table that shows the proportion of flights that are delayed at departure for each of the four time intervals?

A)
```
flights %>%
  add_column(dep_delayed = ifelse(dep_delay > 0, "delayed", "ontime")) %>%
  freq_table(time_of_day, dep_delayed) %>%
  group_by(time_of_day) %>%
  add_column(prop_delayed = n / sum(n)) %>%
  filter(dep_delayed == "delayed") %>%
  arrange(prop_delayed)
```
B)
```
flights %>%
  mutate(dep_delayed = ifelse(dep_delay > 0, "delayed", "ontime")) %>%
  count(time_of_day, dep_delayed) %>%
  group_by(time_of_day) %>%
  mutate(prop_delayed = n / sum(n)) %>%
  filter(dep_delayed == "delayed") %>%
  arrange(prop_delayed)
```
C)
```
flights %>%
  mutate(dep_delayed = ifelse(dep_delay > 0, "delayed", "ontime")) %>%
  count(time_of_day, dep_delayed) %>%
  group_by(time_of_day) %>%
  filter(dep_delayed == "delayed") %>%
  mutate(prop_delayed = n / sum(n)) %>%
  arrange(prop_delayed)
```
D)   
```
flights %>%
  add_column(dep_delayed = ifelse(dep_delay > 0, "delayed", "ontime")) %>%
  freq_table(time_of_day, dep_delayed) %>%
  group_by(time_of_day) %>%
  filter(dep_delayed == "delayed") %>%
  add_column(prop_delayed = n / sum(n)) %>%
  arrange(prop_delayed)
```




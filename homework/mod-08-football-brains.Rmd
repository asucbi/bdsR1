---
title: "HW 08 - Bike rentals in DC"
knit: (function(inputFile, encoding) {
    rmarkdown::render(inputFile, encoding = encoding, output_dir = "../docs/hws/")
  })
link-citations: yes
---

```{r include = FALSE}
knitr::opts_chunk$set(
  eval = FALSE,
  out.width = "80%",
  fig.asp = 0.618,
  fig.width = 10,
  dpi = 300
)
```

```{r photo, fig.margin = TRUE, echo = FALSE, fig.width = 3, fig.cap = "Photo by Viktor Kern on Unsplash", eval = TRUE}
knitr::include_graphics("https://commons.wikimedia.org/wiki/File:Clemson_and_Temple.jpg")
```

Bike sharing systems are new generation of traditional bike rentals where whole process from membership, rental and return back has become automatic. Through these systems, a user is able to easily rent a bike from a particular position and return back at another position. Today, there exists great interest in these systems due to their important role in traffic, environmental and health issues.

Apart from interesting real world applications of bike sharing systems, the characteristics of data being generated by these systems make them attractive for the research. Opposed to other transport services such as bus or subway, the duration of travel, departure and arrival position is explicitly recorded in these systems. This feature turns bike sharing system into a virtual sensor network that can be used for sensing mobility in the city. Hence, it is expected that most of important events in the city could be detected via monitoring these data.

Source: [UCI Machine Learning Repository - Bike Sharing Dataset](http://archive.ics.uci.edu/ml/datasets/Bike+Sharing+Dataset)

# Getting started

Go to the course Posit Cloud Workspace and locate the Module 8 assignment project (or your own copy of it if you have already started it.)

First, open the R Markdown document `hw-08.Rmd` and Knit it.

## Warm up

Before we introduce the data, let's warm up with some simple exercises. Update the YAML of your R Markdown file with your information, knit, and examine the output.

## Packages

We'll use the **tidyverse** package for much of the data wrangling and visualization and the data lives in the **dsbox** package.
These packages are already installed for you.
You can load them by running the following in your Console:

```{r load-packages, message = FALSE, eval = TRUE}
library(tidyverse)
library(dsbox)
```

## Data

The data can be found in the **dsbox** package, and it's called `dcbikeshare`.
Since the dataset is distributed with the package, we don't need to load it separately; it becomes available to us when we load the package.
You can find out more about the dataset by inspecting its documentation, which you can access by running `?dcbikeshare` in the Console or using the Help menu in RStudio to search for `dcbikeshare`.
You can also find this information [here](https://rstudio-education.github.io/dsbox/reference/dcbikeshare.html).

The data include daily bike rental counts (by members and casual users) of Capital Bikeshare in Washington, DC in 2011 and 2012 as well as weather information on these days.
The original data sources are <http://capitalbikeshare.com/system-data> and <http://www.freemeteo.com>.

# Exercises

## Data wrangling

1.  Recode the `season` variable to be a factor with meaningful level names as outlined in the codebook, with spring as the baseline level.

3.  Recode the `yr` variable to be a factor with levels 2011 and 2012, with 2011 as the baseline level.

4.  Recode the `weathersit` variable as 1 - clear, 2 - mist, 3 - light precipitation, and 4 - heavy precipitation, with clear as the baseline.

5.  Weather can be an important factor in people's transportation decisions. The temperature, feeling temperature, humidity, and windspeed variables have each been "normalized" by dividing the raw values by the maximum observed value. For our purposes, it would be better to work with the raw values. Look at the data codebook using `?dcbikeshare` and calculate raw temperature, feeling temperature, humidity, and windspeed as their values given in the dataset multiplied by the maximum raw values stated in the codebook for each variable. It's fine to overwrite the original variables.


ðŸ§¶ ðŸ‘€ ðŸ’¾   *Now is a good time to save and knit your document and confirm the outputs look as you expect them to.*

## Exploratory data analysis

6.  Recreate the following visualization, and interpret it in context of the data. **Hint:** You will need to use one of the variables you created above. The temperature plotted is the feeling temperature.

```{r fig.fullwidth = TRUE, echo=FALSE, eval=TRUE}
dcbikeshare %>%
  mutate(atemp_raw = atemp * 50) %>%
  ggplot(mapping = aes(x = dteday, y = cnt, color = atemp_raw)) +
    geom_point(alpha = 0.7) +
    labs(
      title = "Bike rentals in DC, 2011 and 2012",
      subtitle = "Warmer temperatures associated with more bike rentals",
      x = "Date",
      y = "Bike renrals",
      color = "Feeling Temp. (C)"
    ) +
  theme_minimal()
```

7.  Create a visualization displaying the relationship between bike rentals and season. Interpret the plot in context of the previous plot.

ðŸ§¶ ðŸ‘€ ðŸ’¾   *Now is a good time to save and knit your document and confirm the outputs look as you expect them to.*

## Modelling

8.  Fit a linear model predicting total daily bike rentals from daily temperature.
    Write the linear model, interpret the slope and the intercept in context of the data, and determine and interpret the $R^2$.

9. Fit another linear model predicting total daily bike rentals from daily feeling temperature.
    Write the linear model, interpret the slope and the intercept in context of the data, and determine and interpret the $R^2$.
    Is temperature or feeling temperature a better predictor of bike rentals?
    Explain your reasoning.
    
10. Create a new centered daily feeling temperature predictor and fit a model predicting total daily bike rentals using your new variable. Compare this model to the previous in terms of its coefficients and $R^2$. What has changed? What has stayed the same? Explain what is going on.

11. Fit a model predicting total daily bike rentals from season, year, whether the day is holiday or not, whether the day is a workingday or not, the weather category, temperature, feeling temperature, humidity, and windspeed, as well as the interaction between feeling temperature and holiday. Compare this model with the better of the two prior models using AIC. Which model seems best?

12. Calculate the slope of feeling temperature for holidays and non-holidays and interpret both values.

13. According to this model, assuming everything else is the same, in which season does the model predict total daily bike rentals to be highest and which to be the lowest? Does this prediction match the plot you made earlier?

ðŸ§¶ ðŸ‘€ ðŸ’¾   *Now is a good time to save and knit your document and confirm the outputs look as you expect them to.*

# Submitting your work

Once you are happy with the final state of your work, change the YAML `output` from `html_output` to `pdf_output.` Now knit the document to produce a final PDF file. Upload the PDF to the Canvas assignment.  
<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>HW 06 - Money in US politics</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="header">



<h1 class="title toc-ignore">HW 06 - Money in US politics</h1>

</div>


<div class="figure">
<img src="img/sharon-mccutcheon-rItGZ4vquWk-unsplash.jpg" alt="Photo by Sharon McCutcheon on Unsplash" width="80%" />
<p class="caption">
Photo by Sharon McCutcheon on Unsplash
</p>
</div>
<p>Every election cycle brings its own brand of excitement – and lots of
money. Political donations are of particular interest to political
scientists and other researchers studying politics and voting patterns.
They are also of interest to citizens who want to stay informed of how
much money their candidates raise and where that money comes from.</p>
<p>In the United States, <em>“only American citizens (and immigrants
with green cards) can contribute to federal politics, but the American
divisions of foreign companies can form political action committees
(PACs) and collect contributions from their American employees.”</em><a
href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>In this assignment we will scrape and work with data foreign
connected PACs that donate to US political campaigns. First, we will get
data foreign connected PAC contributions in the 2022 election cycle.
Then, you will use a similar approach to get data such contributions
from previous years so that we can examine trends over time.</p>
<p>In order to complete this assignment you will need a Chrome browser
with the <a href="http://selectorgadget.com/">Selector Gadget
extension</a> installed.</p>
<div id="getting-started" class="section level1">
<h1>Getting started</h1>
<p>Go to Posit Cloud and find your homework R Markdown document, open it
up and adjust the YAML with your information. Knit the document to make
sure it compiles without errors.</p>
<div id="packages" class="section level2">
<h2>Packages</h2>
<p>We’ll use the <strong>tidyverse</strong> package for much of the data
wrangling and visualization, the <strong>robotstxt</strong> package to
check if we’re allowed to scrape the data, the <strong>rvest</strong>
package for data scraping, and the <strong>scales</strong> package for
better formatting of labels on visualizations. These packages are
already installed for you. You can load them by running the following in
your Console:</p>
<pre class="r"><code>library(tidyverse)
library(robotstxt)
library(rvest)
library(scales)</code></pre>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p>This assignment does not come with any prepared datasets. Instead
you’ll be scraping the data!</p>
</div>
</div>
<div id="exercises" class="section level1">
<h1>Exercises</h1>
<div id="data-collection-via-web-scraping" class="section level2">
<h2>Data collection via web scraping</h2>
<p><img src="img/opensecrets.png" width="80%" /></p>
<p>The data come from <a
href="https://www.opensecrets.org">OpenSecrets.org</a>, a <em>“website
tracking the influence of money on U.S. politics, and how that money
affects policy and citizens’ lives”</em>. This website is hosted by The
Center for Responsive Politics, which is a nonpartisan, independent
nonprofit that <em>“tracks money in U.S. politics and its effect on
elections and public policy.”</em><a href="#fn2" class="footnote-ref"
id="fnref2"><sup>2</sup></a></p>
<p>Before getting started, let’s check that a bot has permissions to
access pages on this domain.</p>
<pre class="r"><code>library(robotstxt)
paths_allowed(&quot;https://www.opensecrets.org&quot;)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Our goal is to scrape data for contributions in all election years
Open Secrets has data for. Since that means repeating a task many times,
let’s first write a function that works on the first page. Confirm it
works on a few others. Then iterate it over pages for all years.</p>
<div class="box">
<p>Complete the following set of steps in the <code>scrape-pac.R</code>
file in the <code>scripts</code> folder of your repository. This file
already contains some starter code to help you out.</p>
</div>
<ul>
<li><p>Write a function called <code>scrape_pac()</code> that scrapes
information from the Open Secrets webpage for foreign-connected PAC
contributions in a given year (see Footnote 1 for the relevant table).
This function should</p>
<ul>
<li>have one input: the URL of the webpage and should return a data
frame.</li>
<li>rename variables scraped, using <code>snake_case</code> naming.</li>
<li>add a new column to the data frame for <code>year</code>. We will
want this information when we ultimately have data from all years, so
this is a good time to keep track of it. Our function doesn’t take a
year argument, but the year is embedded in the URL, so we can extract it
out of there, and add it as a new column. Use the <code>str_sub()</code>
function to extract the last 4 characters from the URL. You will
probably want to look at the help for this function to figure out how to
specify “last 4 characters”.</li>
</ul></li>
<li><p>Define the URLs for 2022, 2020, and 2000 contributions. Then,
test your function using these URLs as inputs. Does the function seem to
do what you expected it to do?</p></li>
<li><p>Construct a vector called <code>urls</code> that contains the
URLs for each webpage that contains information on foreign-connected PAC
contributions for <em>every other year</em> starting at 2000 and going
up to 2022 (e.g., 2000, 2002, 2004, etc.)</p></li>
<li><p>Map the <code>scrape_pac()</code> function over <code>urls</code>
in a way that will result in a data frame called
<code>pac_all</code>.</p></li>
<li><p>Write the data frame to a csv file called
<code>pac-all.csv</code> in the <code>data</code> folder.</p></li>
</ul>
</div>
<div
id="complete-the-following-set-of-steps-in-the-hw-06.rmd-file-in-your-repository."
class="section level2">
<h2>Complete the following set of steps in the <code>hw-06.Rmd</code>
file in your repository.</h2>
</div>
<ol style="list-style-type: decimal">
<li>In your R Markdown file, load <code>pac-all.csv</code> and report
its number of observations and variables using inline code.</li>
</ol>
<div id="data-cleaning" class="section level2">
<h2>Data cleaning</h2>
<p>In this section we clean the <code>pac_all</code> data frame to
prepare it for analysis and visualization. We have two goals in data
cleaning:</p>
<ul>
<li><p>Separate the <code>country_parent</code> into two such that
country and parent company appear in different columns for country-level
analysis.</p></li>
<li><p>Convert contribution amounts in <code>total</code>,
<code>dems</code>, and <code>repubs</code> from character strings to
numeric values.</p></li>
</ul>
<p>The following exercises walk you through how to make these fixes to
the data.</p>
<ol start="2" style="list-style-type: decimal">
<li><p>Use the <code>separate()</code> function to separate
<code>country_parent</code> into <code>country</code> and
<code>parent</code> columns. Note that country and parent company names
are separated by <code>/</code> (which will need to be specified in your
function) and also note that there are some entries where the
<code>/</code> sign appears twice and in these cases we want to only
split the value at the first occurrence of <code>/</code>. This can be
accomplished by setting the <code>extra</code> argument to
<code>"merge"</code> so that the cell is split into only 2 segments,
e.g. we want <code>"Denmark/Novo Nordisk A/S"</code> to be split into
<code>"Denmark"</code> and <code>"Novo Nordisk A/S"</code>. (See help
for <code>separate()</code> for more on this.)</p>
<p>End your code chunk by printing out the top 10 rows of your data
frame (you can use <code>head()</code> to do this).</p></li>
<li><p>Remove the character strings including “$” and “,” in the
<code>total</code>, <code>dems</code>,and <code>repubs</code> columns
and convert these columns to numeric. End your code chunk by printing
out the top 10 rows of your data frame (you can use <code>head()</code>
to do this). A couple hints to help you out:</p>
<ul>
<li><p>The <code>$</code> character is a special character so it will
need to be escaped.</p></li>
<li><p>Some contribution amounts are in the millions
(e.g. Anheuser-Busch contributed a total of $1,510,897 in 2008). In this
case we need to remove all occurrences of “,”, which we can do by using
<code>str_remove_all()</code> instead of
<code>str_remove()</code>.</p></li>
</ul></li>
</ol>
<p>When you’re done, the first 10 rows of your data should look
something like this. <strong>Remember:</strong> The contents of the
table might not be identical because the content of the web site changes
over time, but it should close in terms of formatting:</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
parent
</th>
<th style="text-align:right;">
total
</th>
<th style="text-align:right;">
dems
</th>
<th style="text-align:right;">
repubs
</th>
<th style="text-align:right;">
year
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
7-Eleven
</td>
<td style="text-align:left;">
Japan
</td>
<td style="text-align:left;">
Ito-Yokado
</td>
<td style="text-align:right;">
8500
</td>
<td style="text-align:right;">
1500
</td>
<td style="text-align:right;">
7000
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
ABB Group
</td>
<td style="text-align:left;">
Switzerland
</td>
<td style="text-align:left;">
Asea Brown Boveri
</td>
<td style="text-align:right;">
46000
</td>
<td style="text-align:right;">
17000
</td>
<td style="text-align:right;">
28500
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
Accenture
</td>
<td style="text-align:left;">
UK
</td>
<td style="text-align:left;">
Accenture plc
</td>
<td style="text-align:right;">
75984
</td>
<td style="text-align:right;">
23000
</td>
<td style="text-align:right;">
52984
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
ACE INA
</td>
<td style="text-align:left;">
UK
</td>
<td style="text-align:left;">
ACE Group
</td>
<td style="text-align:right;">
38500
</td>
<td style="text-align:right;">
12500
</td>
<td style="text-align:right;">
26000
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
Acuson Corp (Siemens AG)
</td>
<td style="text-align:left;">
Germany
</td>
<td style="text-align:left;">
Siemens AG
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
Adtranz (DaimlerChrysler)
</td>
<td style="text-align:left;">
Germany
</td>
<td style="text-align:left;">
DaimlerChrysler AG
</td>
<td style="text-align:right;">
10500
</td>
<td style="text-align:right;">
10000
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
AE Staley Manufacturing (Tate &amp; Lyle)
</td>
<td style="text-align:left;">
UK
</td>
<td style="text-align:left;">
Tate &amp; Lyle
</td>
<td style="text-align:right;">
24000
</td>
<td style="text-align:right;">
10000
</td>
<td style="text-align:right;">
14000
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
AEGON USA (AEGON NV)
</td>
<td style="text-align:left;">
Netherlands
</td>
<td style="text-align:left;">
Aegon NV
</td>
<td style="text-align:right;">
58250
</td>
<td style="text-align:right;">
10500
</td>
<td style="text-align:right;">
47750
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
AIM Management Group
</td>
<td style="text-align:left;">
UK
</td>
<td style="text-align:left;">
AMVESCAP
</td>
<td style="text-align:right;">
25000
</td>
<td style="text-align:right;">
10000
</td>
<td style="text-align:right;">
15000
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
Air Liquide America
</td>
<td style="text-align:left;">
France
</td>
<td style="text-align:left;">
L’Air Liquide SA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2000
</td>
</tr>
</tbody>
</table>
</div>
<div id="data-visualization-and-interpretation" class="section level2">
<h2>Data visualization and interpretation</h2>
<ol start="4" style="list-style-type: decimal">
<li><p>Create a line plot of total contributions from all
foreign-connected PACs in the Canada and Mexico over the years. Once you
have made the plot, write a brief interpretation of what the graph
reveals. Few hints to help you out:</p>
<ul>
<li>Filter for only <code>Canada</code> and <code>Mexico</code>.</li>
<li>Calculate sum of total contributions from PACs for each year for
each country by using a sequence of <code>group_by()</code> then
<code>summarize()</code>.</li>
<li>Make a plot of total contributions (y-axis) by year (x-axis) where
two lines identified by different colors represent each of Canada and
Mexico.</li>
</ul></li>
</ol>
<pre class="marginfigure"><code>**Note:** The figure you create might look slightly different than this one if the data on the website has been updated recently.</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Recreate the following visualization. Once you have made the plot,
write a brief interpretation of what the graph reveals. Note that these
are only UK contributions. You will need to make use of functions from
the <strong>scales</strong> package for axis labels as well as from
<strong>ggplot2</strong>.</li>
</ol>
<p><img src="mod-06-money-in-politics_files/figure-html/unnamed-chunk-5-1.png" width="80%" /></p>
</div>
</div>
<div id="submitting-your-work" class="section level1">
<h1>Submitting your work</h1>
<p>Once you are happy with the final state of your work, change the YAML
<code>output</code> from <code>html_output</code> to
<code>pdf_output.</code> Now knit the document to produce a final PDF
file. Upload the PDF as a Canvas assignment.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Source: <a
href="https://www.opensecrets.org/political-action-committees-pacs/foreign-connected-pacs">Open
Secrets - Foreign Connected PACs</a>.<a href="#fnref1"
class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Source: <a
href="https://www.opensecrets.org/about/">Open Secrets - About</a>.<a
href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
